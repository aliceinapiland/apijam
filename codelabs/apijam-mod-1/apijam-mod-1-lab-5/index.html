
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Lab 5 - Measure API Program Success with Apigee Analytics</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="apijam-mod-1-lab-5"
                  title="Lab 5 - Measure API Program Success with Apigee Analytics"
                  environment="web"
                  feedback-link="https://docs.google.com/forms/d/e/1FAIpQLSfyEW7pEyVVumcBzV2UU70XDoow-fneUEApznxkhL_buTNevA/viewform?entry.1505955013=Virtual&#43;API&#43;Jam&#43;-&#43;API&#43;Management">
    
      <google-codelab-step label="Introduction" duration="0">
        <p><em>Duration : 15 mins</em></p>
<p><em>Persona : API Product Team</em></p>
<h2 is-upgraded><strong>Use Case</strong></h2>
<h3 is-upgraded><strong>What comes after publishing the first API Product</strong></h3>
<p>After you have some API Products up and running you want to have a look at how the program performs and how successful your API program is.</p>
<ul>
<li>How is traffic trending over time?</li>
<li>When is the traffic flowing fastest?</li>
<li>Where are the most users?</li>
<li>What are the most active developers?</li>
</ul>
<h3 is-upgraded><strong>Insights help with capacity planning</strong></h3>
<p>With trend usage data you can see how your API calls are trending over time and predict how the traffic will be in the next year, when you need to do your capacity planning</p>
<p>Through visualization of the data with out of the box analytics, Apigee helps you with finding the trends and patterns of your APIs</p>
<h3 is-upgraded><strong>Tying traffic to API Products</strong></h3>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/5f0b371ae545452a.png"></p>
<p>When registering an application to an API product that metadata is loaded when verifying an API key or Oauth Token so you can identify the Developer, App and the Product. This data is crucial for insights into your program.</p>
<h2 is-upgraded><strong>Pre-requisites</strong></h2>
<ul>
<li>If you have followed previous modules you can probably already see some traffic for the proxies you have created earlier and work with your previous API proxy for the custom statistics.</li>
<li>If you haven&#39;t followed previous models you can follow this lab too but will see less data in your dashboards.</li>
<li>(Optional) If you want the full experience setup a load generator before to see some data in your dashboards.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="(optional) Add some load to API proxies" duration="0">
        <p>If you have not followed previous modules you can use a load generator to have some data in your reports.</p>
<p>You have to have an API proxy with a default API key policy and 3 API keys ideally for different Apps and API products.</p>
<h2 is-upgraded><strong>Configure and Run Load Generator</strong></h2>
<p>You can create a new proxy by uploading the proxy in the <em>loadgen</em> folder in this repository.</p>
<ol type="1" start="1">
<li>Create a new proxy by clicking Develop &gt; API Proxies &gt; + Proxy</li>
<li>In the new proxy wizard select to upload a proxy bundle and upload your .zip file from the repository. You can download this .zip file <a href="https://github.com/aliceinapiland/apijam/blob/master/Module-1/Labs/Lab%205/loadgen/LoadGen-Proxy.zip?raw=true" target="_blank">here</a></li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/739a889d8370cf05.png"></p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/fef37d6e219a3bdb.png"></p>
<ol type="1" start="3">
<li>Click Build.</li>
<li>After the proxy was created you can directly open it in the editor and go to the Develop tab to change the values for your proxies and api keys. Navigate to the config/model.json resource in the Resources section on the left panel, and change the values as shown below:</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/8c0352d0b32470c2.png"></p>
<ol type="1" start="5">
<li>After changing the values Save and deploy the proxy and run the proxy from the Trace tab.</li>
<li>Let the load generator run for a while and undeploy it to make it stop producing traffic.</li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Understand API usage using the pre-built Apigee analytics dashboards" duration="0">
        <p>Apigee comes with a lot of pre built reports. For the purpose of these labs and in the interest of time, we will walk through the different dashboards with screenshots from populated demo environments. Feel free to use the optional load generator to follow along in your own environment.</p>
<p>If you prefer you can have a look at the API Dashboards by watching this video that gives you an overview of the metrics dashboards with a lot of filled values: <a href="https://youtu.be/mElNO44QQFQ?t=126" target="_blank">https://youtu.be/mElNO44QQFQ?t=126</a></p>
<p>To get to the reports open the Analyze menu in the sidebar.</p>
<p class="image-container"><img alt="image alt text" style="width: 616.00px" src="img/47cff798119fe9b.png"></p>
<h2 is-upgraded><strong>API Proxy Performance</strong></h2>
<p>The Proxy Performance dashboard helps you see API proxy traffic patterns and processing times. You can easily visualize how much traffic your APIs generate and how long it takes for API calls to be processed, from the time they are received by Apigee Edge until they are returned to the client app.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/94c58046cbd25aa2.png"></p>
<h2 is-upgraded><strong>Cache Performance</strong></h2>
<p>The Cache Performance dashboard lets you see at a glance the value of your Apigee Edge cache. The dashboard helps you visualize the benefit of the cache in terms of lower latency and reduced load backend servers.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/ef9d7ba9c95e49d8.png"></p>
<h2 is-upgraded><strong>Error Code Analysis</strong></h2>
<p>The Error Code Analysis dashboard tells you about error rates for API proxies and targets. The Error Code Analysis dashboard uses:</p>
<ul>
<li>The response code to calculate proxy errors</li>
<li>The target response code to calculate target errors</li>
</ul>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/e5fb20003eaa06e7.png"></p>
<h2 is-upgraded><strong>Target Performance</strong></h2>
<p>The Target Performance dashboard helps you visualize traffic patterns and performance metrics for API proxy backend targets.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/5debf50928d7e3ee.png"></p>
<h2 is-upgraded><strong>Developer Engagement</strong></h2>
<p>The Developer Engagement dashboard tells you which of your registered app developers are generating the most API traffic. For each of your developers, you can find out who is generating the most API traffic and the most errors. For example, if a particular developer&#39;s app is generating a lot of errors relative to other developers, you can pro-actively address the problem with that developer.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/5bf0fbe3fb94a132.png"></p>
<p>In the main view, if it is enabled, select the Analyze button under the Actions column for the app to view details about that app and the app developer. The following chart appears:</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/42aacb6311556822.png"></p>
<h2 is-upgraded><strong>Traffic Composition</strong></h2>
<p>The Traffic Composition dashboard measures the relative contribution of your top APIs, apps, developers, and products to your overall API program.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/6ae1f2686adb4d49.png"></p>
<h2 is-upgraded><strong>Devices</strong></h2>
<p>The Devices dashboard tells you about the devices and servers that are being used to access your APIs. It lets you spot trends in how users are accessing your APIs. For instance, you might notice that traffic from one type of device is increasing, while another is going down, and then decide if the change requires any action or not.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/c348b841d68acdd5.png"></p>
<h2 is-upgraded><strong>Geomap</strong></h2>
<p>The Geo Map dashboard tracks traffic patterns, error patterns, and quality of service across geographical locations. You can view information about all your APIs, or zoom in on specific ones.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/f134a09f529d125d.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Add Statistics Collector Policy for custom analytics collection" duration="0">
        <ol type="1" start="1">
<li>Click on Develop â†’ API Proxies from side navigation menu. Open the existing Hipster Products API Proxy that you created in previous labs, and go to the Develop tab.</li>
<li>To get the data from the path we need to extract it into an Apigee Flow variable first. We do this by adding an Extract Variables policy.</li>
<li>In the GetProductDetails Flow add a new step to the request by clicking the &#34;+ Step&#34; button</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/7bfb6f0e564c6c33.png"></p>
<ol type="1" start="4">
<li>Add an Extract Variables Policy under the &#34;Mediation&#34; category.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/5a09d5845ad63bed.png"></p>
<ol type="1" start="5">
<li>Add an Extract Variables Policy under the &#34;Mediation&#34; category.</li>
</ol>
<p><code><ExtractVariables name="ExtractVariables-1"></code></p>
<p><code>   <DisplayName>EV-ExtractProductID </DisplayName></code></p>
<p><code>   <Source>request</Source></code></p>
<p><code>   <URIPath></code></p>
<p><code>      <Pattern ignoreCase="true">/products/{productId}</Pattern></code></p>
<p><code>   </URIPath></code></p>
<p><code>   <VariablePrefix>urirequest</VariablePrefix></code></p>
<p><code>   <IgnoreUnresolvedVariables>true</IgnoreUnresolvedVariables></code></p>
<p><code></ExtractVariables></code></p>
<ol type="1" start="6">
<li>In the GetProductDetails add a new step to the request by clicking the &#34;+ Step&#34; button</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/82aa8d0686c1bf46.png"></p>
<ol type="1" start="7">
<li>Add a Statistics Collector Policy under the &#34;Extensions&#34; Category.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/1d42d7c4b598f963.png"></p>
<ol type="1" start="8">
<li>Edit the new Statistics Collector policy and provide it with the following values.</li>
</ol>
<p><code><?xml version="1.0" encoding="UTF-8" standalone="yes"?></code></p>
<p><code><StatisticsCollector async="false" continueOnError="false" enabled="true" name="Statistics-Collector-1"></code></p>
<p><code>    <DisplayName>SC-CollectStatistics</DisplayName></code></p>
<p><code>    <Properties/></code></p>
<p><code>    <Statistics></code></p>
<p><code>        <Statistic name="productID" ref="urirequest.productId" type="STRING"/></code></p>
<p><code>    </Statistics></code></p>
<p><code></StatisticsCollector></code></p>
<ol type="1" start="9">
<li>Run a trace session. Click on the Trace tab and click Start Trace Session to start a trace session. Enter the api key from one of your Apps as a query parameter before clicking Send. Click on the Extract Variables Policy Icon to see the value in a variable. This value is picked up by our Statistics Collector policy.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/b47971c7fd436714.png"></p>
<p>Play around with different api keys from different API</p>
<p>Note: It takes about 30 minutes for a new custom dimension to be added to the database after the Statistics Collector policy is invoked for the first time, for each environment.</p>
<p>For example, if a Statistics Collector proxy is invoked in the test environment, data for that custom dimension starts to be available in the test environment 30 minutes later, and the custom dimension will appear in the custom reports Dimensions drop-down list.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Create custom report" duration="0">
        <p>Now we want to have a look at the data we collected in our API proxy. To do that we need to create a custom report that looks for the value we have defined in the statistics collector policy before.</p>
<ol type="1" start="1">
<li>Under Analyze &gt; Custom Reports &gt; Reports open the Custom Reports Menu</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/d26dfd436d3ab14.png"></p>
<ol type="1" start="2">
<li>Click + Custom Report to create a new custom report</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/dac14be5e4fb22a8.png"></p>
<ol type="1" start="3">
<li>Now we can give the custom report a descriptive report name and report description. We also want to define the metric we want to see in our Y-axis. A custom statistic variable could also be here if we would have defined it as an integer rather than a string.</li>
</ol>
<p>For our example we want to see the Traffic of our proxy</p>
<p>We also define the Dimensions we want to group our traffic by. By selecting multiple dimensions we can drill down our report to find more information on the traffic metric.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/99e001bb64f726ff.png"></p>
<ol type="1" start="4">
<li>In this lab we want to use these dimensions to demonstrate the drill down functionality. For this we chose Country, Developer App and productId as our dimensions.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/1489faa238a81b4e.png"></p>
<ol type="1" start="5">
<li>Take a look at the other dimensions to choose from. Besides our productID that we defined in our statistics collector policy you will find other common dimensions predefined by Apigee.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 276.00px" src="img/1bfc60aa53743599.png"></p>
<ol type="1" start="6">
<li>When finished click Save at the bottom right.</li>
<li>In the report chose a proper range to filter. Make sure you are starting now or in the future and look back long enough. Maybe 1 hour as the default is too short.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/18c324172c663617.png"></p>
<ol type="1" start="8">
<li>Now you see the traffic grouped by our first dimension. In our case all of our traffic is coming from IE. In your case this will be different and in production this will definately be more diverse.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/8fa048c9cbdb2cfd.png"></p>
<ol type="1" start="9">
<li>Drill down into the report by clicking the blue column.</li>
</ol>
<p>Now we see the traffic split by Apps. This helps us to identify apps that are generating a lot of traffic to look closer at.</p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/f76531b011fddb27.png"></p>
<ol type="1" start="10">
<li>Let&#39;s look at the fg_Hipster Android App Free for example.</li>
</ol>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/f7471e2bee6ad418.png"></p>
<ol type="1" start="11">
<li>Now we see the product IDs that were fetched.</li>
</ol>
<p>You can also download the data as CSV by clicking the download button to the right.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Get Statistics via Management API" duration="0">
        <p>Visit the Management API documentation where you can also conveniently try out API calls:</p>
<p><a href="https://apidocs.apigee.com/management/apis/get/organizations/%7Borg_name%7D/environments/%7Benv_name%7D/stats/%7Bdimension_name%7D-0" target="_blank">https://apidocs.apigee.com/management/apis/get/organizations/%7Borg_name%7D/environments/%7Benv_name%7D/stats/%7Bdimension_name%7D-0</a></p>
<h3 is-upgraded><strong>Enter the values and execute an API call</strong></h3>
<p>In the documentation you can interactively make calls to your organization to see how the results look like.</p>
<ul>
<li>Enter your the API call data in the blue Resource URL fields:</li>
<li>{org_name}: your organization</li>
<li>{env_name}: your environment</li>
<li>{dimension_name}: apiproxy</li>
<li>Fill in the data in the table:</li>
<li>Select: sum(message_count)</li>
<li>timeRange: 08/01/2019 00:00~08/30/2019 23:59</li>
<li>Filter: (apiproxy eq &#39;weather-analytics&#39;)</li>
</ul>
<p>Caution: Update Time Range accordingly to have the end range date in the present.</p>
<ul>
<li>Authenticate with your Apigee username and password that you use to login into the Admin UI.</li>
<li>Send a request by clicking the Send this request button</li>
</ul>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/c62dc33c26f2028f.png"></p>
<p class="image-container"><img alt="image alt text" style="width: 624.00px" src="img/1342f9d07543034f.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Lab 5 - Summary" duration="0">
        <p>In this lab you have explored all Reports that show you the success and performance of you API Program and give you valuable insights into how to optimize your APIs.</p>
<h2 is-upgraded><strong>Quiz</strong></h2>
<ul>
<li>Why did this lab use the data type string in productId although its numerical values in the API specification?</li>
<li>What happens if you put multiple statistics collectors in the proxy flow?</li>
</ul>
<h2 class="checklist" is-upgraded><strong>What we&#39;ve covered</strong></h2>
<ul class="checklist">
<li>Overview of the built in Apigee Dashboards</li>
<li>Modified a proxy to collect custom statistics data</li>
<li>Create a custom report using the data from API calls and defining dimensions to drill down for more details.</li>
</ul>
<h2 is-upgraded><strong>References</strong></h2>
<h3 is-upgraded><strong>Apigee Docs Links</strong></h3>
<p><a href="https://docs.apigee.com/api-platform/analytics/use-analytics-api-measure-api-program-performance" target="_blank">https://docs.apigee.com/api-platform/analytics/use-analytics-api-measure-api-program-performance</a></p>
<p>Analytics dashboards overview - <a href="https://docs.apigee.com/api-platform/analytics/using-analytics-dashboards" target="_blank">https://docs.apigee.com/api-platform/analytics/using-analytics-dashboards</a></p>
<p>Exract Variables Policy - <a href="https://docs.apigee.com/api-platform/reference/policies/extract-variables-policy" target="_blank">https://docs.apigee.com/api-platform/reference/policies/extract-variables-policy</a></p>
<p>Statistics Collector Policy - <a href="https://docs.apigee.com/api-platform/reference/policies/statistics-collector-policy" target="_blank">https://docs.apigee.com/api-platform/reference/policies/statistics-collector-policy</a></p>
<p>Create and manage custom reports - <a href="https://docs.apigee.com/api-platform/analytics/create-custom-reports" target="_blank">https://docs.apigee.com/api-platform/analytics/create-custom-reports</a></p>
<p>Example of custom report with statistics collector - <a href="https://docs.apigee.com/api-platform/analytics/analyze-api-message-content-using-custom-analytics" target="_blank">https://docs.apigee.com/api-platform/analytics/analyze-api-message-content-using-custom-analytics</a></p>
<h3 is-upgraded><strong>Videos (4mv4d)</strong></h3>
<p>Extract Variables Policy - <a href="https://www.youtube.com/watch?v=KqFpnNt_8yo" target="_blank">https://www.youtube.com/watch?v=KqFpnNt_8yo</a></p>
<p>Measurement and KPIs for APIs - <a href="https://www.youtube.com/watch?v=x6r7xHKNINU" target="_blank">https://www.youtube.com/watch?v=x6r7xHKNINU</a></p>
<p>Measuring and reporting the success of your API program - <a href="https://www.youtube.com/watch?v=VcNKpoakVqQ" target="_blank">https://www.youtube.com/watch?v=VcNKpoakVqQ</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Feedback" duration="0">
        <p>Please take a few minutes to provide your <a href="https://docs.google.com/forms/d/e/1FAIpQLSfyEW7pEyVVumcBzV2UU70XDoow-fneUEApznxkhL_buTNevA/viewform?entry.1505955013=Virtual+API+Jam+-+API+Management" target="_blank"><strong>feedback on this API Jam here</strong></a>.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
